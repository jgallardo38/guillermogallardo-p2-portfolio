---
title: "Data Analysis Exercise"
---

# About the dataset

This dataset records the number of confirmed botulism cases per state each year, along with details on transmission and toxin types from 1899 to 2017. Botulism is a rare yet severe illness caused by toxins produced by Clostridium botulinum bacteria, leading to muscle weakness, paralysis, and potentially life-threatening breathing problems. Updates are provided annually by the Alaska Division of Public Health and California Department of Public Health.

The data was obtained from the CDC's website and is available at this link: [**Botulism CDC**](https://data.cdc.gov/Foodborne-Waterborne-and-Related-Diseases/Botulism/66i6-hisz/about_data).

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(here)
library(readr)
suppressPackageStartupMessages(library(tidyverse))
```

# Loading Data

```{r}
botulism = here::here("cdcdata-exercise","data","Botulism.csv") #setting path
bot = read.csv(botulism)
```

# Understading The Dataset

This dataset includes 2,280 observations and 5 variables, meeting the assignment's requirements. Upon review, no outliers were found and I did find NA's in the state variable which required processing. However, for this exercise, analysis will focus exclusively on the last ten years (2008-2017).

## Data Structure

```{r}
str(bot) #structure of data to understand what this dataset contains
```

## Data Summary

```{r}
summary(bot) #basic summary of data
```

# Processing Data

As mentioned earlier, I will focus on the dataset's last 10 years. There were 16 missing values which were removed due to a missing state.

## Filtering for 10 years
```{r}
bot_10years = bot %>% 
  filter(Year %in% 2008:2017,
         !is.na(State))
```

### New Data Structure

We now have 494 observations and 5 variables.
```{r}
str(bot_10years)
```
 
### New Data Summary
```{r}
summary(bot_10years)
```


## Grouping by Year

This code groups the data by year to visualize the total number of confirmed cases each year and determine which year had the highest occurrences of Botulism.

```{r}
group_year = bot_10years %>% 
  group_by(Year) %>%
  summarize(total_cases = sum(Count)) %>% 
  mutate(percentage_of_total = round((total_cases / sum(total_cases)) * 100, 2))

group_year
```

## Grouping by State

Similarly to the previous code, we are grouping by state to determine which state had the highest occurrence of Botulism.
```{r}
group_state = bot_10years %>% 
  group_by(State) %>%
  filter(!is.na(State)) %>% #Removing NAs
  summarize(total_cases = sum(Count)) %>% #adding all the counts of confirmed cases by state
  arrange(desc(total_cases))  %>% 
  mutate(percentage_of_total = round((total_cases / sum(total_cases)) * 100, 2))

head(group_state) #getting top 6 states

```


## Grouping by Botulism Transmission Type

Lastly, we want to identify the most common transmission type for this disease.
```{r}
group_trans = bot_10years %>% 
  group_by(BotType) %>%
  summarize(total_cases = sum(Count)) %>% 
  arrange(desc(total_cases))  %>% 
  mutate(percentage_of_total = round((total_cases / sum(total_cases)) * 100, 2))

group_trans
```


# Plotting Botulism

## Botulism by Year

This line chart illustrates a rising trend in Botulism cases beginning from 2010, which marked the lowest point on the graph (113 cases). The peak occurred in 2016, with 206 confirmed cases. Next, we will examine the states with the highest impact in the following chart.
```{r}
ggplot(group_year, aes(x = Year, y = total_cases)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Botulism Cases by Year", y = "# of Confirmed Cases") +
  theme_minimal() +
  scale_x_continuous(breaks = unique(group_year$Year))
  
```

## Botulism by State

California stands out as the state with the highest number of confirmed Botulism cases, totaling 545, which accounts for more than half (56%) of all cases. This highlights California's significant impact on the overall number of confirmed cases.
```{r}
ggplot(group_state, aes(reorder(x = State, desc(total_cases)), y = total_cases)) +
  geom_col(fill = "skyblue") +
  labs(title = "Botulism Cases by State", x = "State", y = "# of Confirmed Cases") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
  #scale_x_continuous(breaks = unique(group_year$Year))

```


## Botulism by Transmission Type

In the last 10 years, infants have accounted for the highest proportion of transmissions, comprising 76% of all cases.
```{r}
ggplot(group_trans, aes(x = BotType, y = total_cases)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Botulism Cases by Transmission Type", y = "# of Confirmed Cases") +
  theme_minimal()
  #scale_x_continuous(breaks = unique(group_year$Year))
```

## This section contributed by Benjamin Farias (QNV639)

Creating Synthetic data based on the values from the above exploration. The prompt used is below.
"Write R code that will create synthetic data for cases of botulism by state in the years 2008 to 2017. Make sure to include add 50 states. The columns of the dataset are state, year, and transmission type. For each state, create rows where, on average  the 75% of transmission type are Infant, 12% are foodborne, 11% are wound, and 2% are other. 35% of cases are in California, 10% Pennsylvania, 5% New Jersey, 5% Ohio, 5% Texas, 4% Maryland, and the rest distributed among the remaining states."

The code was slightly modified to fix minimal errors generate by AI.

```{r}
years <- 2008:2017
states <- c("Alabama", "Alaska", "Arizona", "Arkansas", "California", 
            "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", 
            "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", 
            "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", 
            "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", 
            "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", 
            "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", 
            "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", 
            "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", 
            "Washington", "West Virginia", "Wisconsin", "Wyoming")

# Initialize empty dataframe to store data
botulism_data <- data.frame(state = character(),
                            year = integer(),
                            transmission_type = character(),
                            stringsAsFactors = FALSE)

# Define transmission type proportions
transmission_proportions <- c(Infant = 0.75, Foodborne = 0.12, Wound = 0.11, Other = 0.02)

# Define state proportions
state_proportions <- c(California = 0.35, Pennsylvania = 0.10, "New Jersey" = 0.05, 
                       Ohio = 0.05, Texas = 0.05, Maryland = 0.04)
other_states_proportion <- (1 - sum(state_proportions)) / (50 - length(state_proportions))

# Generate data for each state and year
for (year in years) {
  for (state in states) {
    # Determine number of cases for the current state and year
    if (state %in% names(state_proportions)) {
      cases <- round(state_proportions[state] * 100)  # Assuming 100 cases per state per year
    } else {
      cases <- round(other_states_proportion * 100)
    }
    
    # Sample transmission types based on proportions
    transmission_types <- sample(names(transmission_proportions), cases, replace = TRUE, prob = transmission_proportions)
    
    # Create dataframe with state, year, and transmission type
    botulism_data <- rbind(botulism_data, data.frame(state = rep(state, cases),
                                                     year = rep(year, cases),
                                                     transmission_type = transmission_types))
  }
}

# View the first few rows of the generated dataset
head(botulism_data)
```

```{r}
botulism_data %>% 
  group_by(state) %>%
  summarize(total = n()) %>% 
  mutate(percentage_of_total = round((total / sum(total)) * 100, 2)) %>%
  arrange(desc(percentage_of_total))
```
```{r}
botulism_data %>% 
  group_by(transmission_type) %>%
  summarize(total = n()) %>% 
  mutate(percentage_of_total = round((total / sum(total)) * 100, 2)) %>%
  arrange(desc(percentage_of_total))
```

The data is relatively similar to that of the original data, however the original data is already summarized, and this data has 1 row per case.